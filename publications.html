<main class="px-3 my-auto">
  <h1 class="display-4 mb-4">Publications</h1>
  <div id="pub-list" class="text-start mx-auto" style="max-width: 900px;">
    <p class="text-white-50">Loading…</p>
  </div>
</main>

<script>
async function loadPublications() {
  const el = document.getElementById('pub-list');
  try {
    const res = await fetch('assets/publications.json', { cache: 'no-store' });
    if (!res.ok) throw new Error('Failed to load publications.json');
    const pubs = await res.json();

    // Group by year (desc)
    const byYear = pubs.reduce((acc, p) => {
      const y = p.year || 'In press';
      acc[y] = acc[y] || [];
      acc[y].push(p);
      return acc;
    }, {});
    const years = Object.keys(byYear).sort((a, b) => {
      const ai = parseInt(a) || 0, bi = parseInt(b) || 0;
      return bi - ai;
    });

    el.innerHTML = years.map(year => {
      const items = byYear[year].map(p => {
        const authors = p.authors ? `<span class="text-white-50">${p.authors}</span>` : '';
        const venue = p.venue ? `<em>${p.venue}</em>` : '';
        const yearTxt = p.year ? ` (${p.year})` : '';
        const link = p.url || p.eprint_url;
        const linkHtml = link ? `<a href="${link}" target="_blank" rel="noopener">View</a>` : '';
        const cites = (p.cited_by && Number(p.cited_by) > 0) ? `<span class="ms-2 text-white-50">Cited by ${p.cited_by}</span>` : '';
        return `
          <li class="mb-3">
            <strong>${p.title}</strong><br>
            ${authors}<br>
            ${venue}${yearTxt} ${linkHtml} ${cites}
          </li>
        `;
      }).join('');

      return `
        <h3 class="mt-4">${year}</h3>
        <ul class="mt-2">
          ${items}
        </ul>
      `;
    }).join('');
  } catch (e) {
    console.error(e);
    el.innerHTML = `<div class="alert alert-warning">Couldn’t load publications right now.</div>`;
  }
}
loadPublications();
</script>
